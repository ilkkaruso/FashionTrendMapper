---
plan: 04-01
phase: 04-affiliate-integration
title: Amazon Affiliate Links (SiteStripe Approach)
objective: Add Amazon affiliate search links to trend modal using simple URL generation
estimated_tasks: 3
dependencies: []
status: pending
must_haves:
  truths:
    - "getAmazonFashionLink() function generates affiliate URLs with partner tag"
    - "TrendModal displays 'Shop on Amazon' button linking to Amazon search"
    - "Amazon Associates disclosure text shown in modal"
    - "Link opens in new tab with noopener noreferrer nofollow"
  artifacts:
    - path: "lib/affiliate/amazon-links.ts"
      provides: "Amazon affiliate link generators"
      contains: "getAmazonFashionLink"
      min_lines: 15
    - path: "app/components/TrendModal.tsx"
      provides: "Updated modal with Shop on Amazon button"
      contains: "Shop.*on Amazon"
      min_lines: 150
  key_links:
    - from: "app/components/TrendModal.tsx"
      to: "lib/affiliate/amazon-links.ts"
      via: "import getAmazonFashionLink"
      pattern: "import.*getAmazonFashionLink"
---

<objective>
Add Amazon affiliate integration using simple search link generation (SiteStripe approach). This bypasses PA-API requirements (which need 3 sales first) while still enabling affiliate revenue.

Purpose: Enable affiliate monetization immediately without PA-API access. Users click "Shop on Amazon" → see Amazon's search results for the trend → we earn commission on purchases.

Output: Utility function for generating affiliate links and "Shop on Amazon" button in TrendModal.
</objective>

<execution_context>
@/home/lesh/.claude/get-shit-done/workflows/execute-plan.md
@/home/lesh/.claude/get-shit-done/templates/summary.md
</execution_context>

<background>
## Why SiteStripe Instead of PA-API

Amazon PA-API requires 3 qualifying sales before access is granted. For a new site, this creates a chicken-and-egg problem.

**SiteStripe approach:** Generate affiliate links to Amazon search results pages:
```
https://www.amazon.com/s?k=baggy+jeans&i=fashion&tag=yoursite-20
```

Advantages:
- Works immediately (just need Associates account)
- No rate limits or caching needed
- No API credentials required
- Simpler implementation

Once 3 sales are achieved, we can upgrade to PA-API for product images/prices.
</background>

<tasks>
<task id="1">
  <title>Create Amazon affiliate link utility</title>
  <action>
    Create `lib/affiliate/amazon-links.ts`:

    ```typescript
    /**
     * Amazon affiliate link generators (SiteStripe approach)
     *
     * Generates affiliate links to Amazon search results pages.
     * No PA-API required - just needs Amazon Associates partner tag.
     *
     * Link format: https://www.amazon.com/s?k={keyword}&i=fashion&tag={partner-tag}
     */

    /**
     * Get Amazon partner tag from environment
     * Uses NEXT_PUBLIC_ prefix so it's available client-side
     */
    function getPartnerTag(): string {
      return process.env.NEXT_PUBLIC_AMAZON_TAG || '';
    }

    /**
     * Generate Amazon search affiliate link for a keyword
     *
     * @param keyword - Search term (typically trend title)
     * @returns Amazon search URL with affiliate tag
     */
    export function getAmazonSearchLink(keyword: string): string {
      const partnerTag = getPartnerTag();
      const params = new URLSearchParams({
        k: keyword,
        ...(partnerTag && { tag: partnerTag }),
      });

      return `https://www.amazon.com/s?${params.toString()}`;
    }

    /**
     * Generate Amazon Fashion department search link
     *
     * More targeted than general search - restricts to Fashion category.
     *
     * @param keyword - Search term (typically trend title)
     * @returns Amazon Fashion search URL with affiliate tag
     */
    export function getAmazonFashionLink(keyword: string): string {
      const partnerTag = getPartnerTag();
      const params = new URLSearchParams({
        k: keyword,
        i: 'fashion', // Restrict to Fashion department
        ...(partnerTag && { tag: partnerTag }),
      });

      return `https://www.amazon.com/s?${params.toString()}`;
    }

    /**
     * Check if affiliate links are configured
     *
     * @returns true if partner tag is set
     */
    export function isAffiliateConfigured(): boolean {
      return !!getPartnerTag();
    }
    ```
  </action>
  <verify>
    - File exists at lib/affiliate/amazon-links.ts
    - Exports getAmazonSearchLink, getAmazonFashionLink, isAffiliateConfigured
    - Uses NEXT_PUBLIC_AMAZON_TAG env var
    - Generated URLs include i=fashion parameter
    - TypeScript compiles without errors
  </verify>
  <done>Amazon affiliate link utility created</done>
</task>

<task id="2">
  <title>Add Shop on Amazon button to TrendModal</title>
  <action>
    Update `app/components/TrendModal.tsx` to add affiliate button after Related Trends section:

    1. Import the link generator at top of file:
    ```typescript
    import { getAmazonFashionLink } from '@/lib/affiliate/amazon-links';
    ```

    2. Add the Shop on Amazon section after Related Trends (before closing `</div>` of the content area):

    ```tsx
    {/* Shop on Amazon (Affiliate) */}
    <div className="pt-4 border-t border-gray-200">
      <a
        href={getAmazonFashionLink(trend.title)}
        target="_blank"
        rel="noopener noreferrer nofollow"
        className="flex items-center justify-center gap-2 w-full bg-[#FF9900] hover:bg-[#E88B00] text-white font-semibold py-3 px-4 rounded-lg transition-colors"
      >
        <svg className="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
          <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.94-.49-7-3.85-7-7.93s3.06-7.44 7-7.93v15.86zm2-15.86c3.94.49 7 3.85 7 7.93s-3.06 7.44-7 7.93V4.07z"/>
        </svg>
        Shop &ldquo;{trend.title}&rdquo; on Amazon
      </a>
      <p className="text-xs text-gray-500 mt-2 text-center">
        As an Amazon Associate we earn from qualifying purchases.
      </p>
    </div>
    ```

    The button uses Amazon's orange brand color (#FF9900) for recognition.
  </action>
  <verify>
    - TrendModal imports getAmazonFashionLink
    - Button links to Amazon with trend title as search keyword
    - Link has target="_blank" rel="noopener noreferrer nofollow"
    - Associates disclosure text present
    - TypeScript compiles without errors
  </verify>
  <done>Shop on Amazon button added to TrendModal</done>
</task>

<task id="3">
  <title>Add environment variable</title>
  <action>
    Amazon partner tag already added to `.env.local`:

    ```
    NEXT_PUBLIC_AMAZON_TAG=taavster-21
    ```

    The `NEXT_PUBLIC_` prefix makes this available client-side (needed since the link is generated in React component).
  </action>
  <verify>
    - .env.local has NEXT_PUBLIC_AMAZON_PARTNER_TAG entry
    - Build succeeds with env var
  </verify>
  <done>Environment variable configured</done>
</task>
</tasks>

<verification>
All tasks verified when:
1. lib/affiliate/amazon-links.ts exists with link generators
2. TrendModal has "Shop on Amazon" button with correct href
3. Link opens Amazon Fashion search for trend title
4. Associates disclosure visible
5. TypeScript compilation succeeds (`npm run build`)
</verification>

<success_criteria>
- getAmazonFashionLink() generates correct URL format
- TrendModal displays orange "Shop on Amazon" button
- Clicking button opens Amazon search in new tab
- URL includes partner tag when configured
- URL restricts to Fashion department (i=fashion)
- Amazon Associates disclosure shown below button
- Build passes without errors
</success_criteria>

<notes>
## Future Upgrade Path

Once the site achieves 3 qualifying sales through Amazon Associates:

1. Apply for PA-API access in Associates Central
2. Add plans 04-02, 04-03, 04-04 for product grid feature
3. Display actual product images/prices in modal
4. Keep "Shop on Amazon" button as fallback

This approach gets monetization live immediately while leaving room for enhancement.
</notes>

<commit_format>
feat(04-01): add Amazon affiliate links to trend modal
</commit_format>
